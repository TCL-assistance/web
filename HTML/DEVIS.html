<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>&#8203;</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* Logo site (bas de page, non imprimé) */
    .site-footer-logo {
      width: 100%;
      text-align: center;
      padding: 25px 0;
      margin-top: 5px;
    }

    .site-logo-img {
      width: 60px;     /* ajuste si besoin */
      opacity: 0.9;
    }

    :root{
      --bg:#111317;
      --card:#1d2129;
      --accent:#3fb5ff;
      --accent-soft:rgba(63,181,255,0.15);
      --text:#f5f5f5;
      --muted:#a0a4af;
      --border:#2a2f3a;
    }

    *{
      box-sizing:border-box;
    }

    body{
      margin:0;
      padding:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      background:radial-gradient(circle at top,#202736,#111317);
      color:var(--text);
      display:flex;
      flex-direction:column;
      align-items:center;
      min-height:100vh;
    }

    .page{
      width:100%;
      max-width:1000px;
      padding:16px;
    }

    h1{
      margin:0 0 16px;
      font-size:1.2rem;
      text-align:center;
      text-transform:uppercase;
      letter-spacing:0.12em;
      color:var(--accent);
      text-shadow:0 0 8px rgba(63,181,255,0.6);
      line-height:1.25em;
    }

    .h1-sub{
      font-size:1.6rem;
      display:block;
      margin-top:4px;
    }

    .layout{
      display:flex;
      flex-wrap:wrap;
      gap:16px;
    }

    .card{
      background:var(--card);
      border-radius:16px;
      padding:16px;
      border:1px solid var(--border);
      box-shadow:0 14px 35px rgba(0,0,0,0.35);
    }

    .form-card{
      flex:1 1 320px;
      min-width:280px;
    }

    .quote-card{
      flex:1 1 420px;
      min-width:320px;
      background:transparent;
      border:none;
      box-shadow:none;
      padding:0;
    }

    .section-title{
      font-size:0.95rem;
      margin:0 0 12px;
      color:var(--muted);
      text-transform:uppercase;
      letter-spacing:0.08em;
    }

    .form-grid{
      display:grid;
      grid-template-columns:1fr;
      gap:10px;
    }

    label{
      font-size:0.8rem;
      color:var(--muted);
      display:block;
      margin-bottom:3px;
    }

    input[type="text"],
    input[type="number"],
    input[type="date"],
    textarea,
    select{
      width:100%;
      padding:8px 10px;
      border-radius:10px;
      border:1px solid var(--border);
      background:#141821;
      color:var(--text);
      font-size:0.9rem;
      outline:none;
      transition:border 0.15s,box-shadow 0.15s,background 0.15s;
    }

    input[type="text"]:focus,
    input[type="number"]:focus,
    input[type="date"]:focus,
    textarea:focus,
    select:focus{
      border-color:var(--accent);
      box-shadow:0 0 0 1px var(--accent-soft);
      background:#101520;
    }

    textarea{
      resize:vertical;
      min-height:70px;
    }

    .inline-fields{
      display:flex;
      gap:8px;
    }

    .inline-fields > div{
      flex:1;
    }

    .switch-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-top:4px;
    }

    .switch{
      position:relative;
      width:46px;
      height:24px;
    }

    .switch input{
      opacity:0;
      width:0;
      height:0;
    }

    .slider{
      position:absolute;
      cursor:pointer;
      inset:0;
      background:#252a35;
      border-radius:20px;
      transition:.2s;
    }

    .slider:before{
      position:absolute;
      content:"";
      height:18px;
      width:18px;
      left:3px;
      top:3px;
      border-radius:50%;
      background:white;
      transition:.2s;
    }

    .switch input:checked + .slider{
      background:var(--accent);
    }

    .switch input:checked + .slider:before{
      transform:translateX(22px);
    }

    .btn-row{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:10px;
    }

    button{
      border:none;
      border-radius:999px;
      padding:8px 14px;
      font-size:0.85rem;
      font-weight:500;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:6px;
      background:var(--accent);
      color:#021018;
      box-shadow:0 8px 18px rgba(63,181,255,0.35);
      transition:transform 0.1s,box-shadow 0.1s,background 0.1s;
    }

    button:hover{
      transform:translateY(-1px);
      box-shadow:0 10px 22px rgba(63,181,255,0.45);
    }

    button:active{
      transform:translateY(0);
      box-shadow:0 4px 12px rgba(0,0,0,0.5);
    }

    .btn-secondary{
      background:transparent;
      color:var(--accent);
      border:1px solid var(--accent-soft);
      box-shadow:none;
    }

    .btn-secondary:hover{
      background:var(--accent-soft);
      box-shadow:none;
    }

    /* Devis (aperçu) – style "page blanche" */
    .quote-wrapper{
      background:white;
      color:#111;
      border-radius:0;
      border:none;
      padding:24px 22px 18px;
      max-width:800px;
      margin:0 auto;
      box-shadow:none;
      font-size:0.9rem;
    }

    .quote-header{
      display:flex;
      justify-content:space-between;
      gap:12px;
      margin-bottom:18px;
    }

    .company-block{
      font-size:0.8rem;
      line-height:1.4;
    }

    .company-name{
      font-weight:700;
      font-size:1rem;
      text-transform:uppercase;
    }

    .quote-meta{
      text-align:right;
      font-size:0.85rem;
    }

    .quote-meta strong{
      display:inline-block;
      min-width:80px;
    }

    .quote-section{
      margin-bottom:10px;
    }

    .quote-section-title{
      font-weight:600;
      margin-bottom:3px;
    }

    .quote-address{
      white-space:pre-line;
    }

    .quote-desc{
      white-space:pre-line;
      border:1px solid #ddd;
      border-radius:8px;
      padding:10px;
      min-height:60px;
      background:#fafafa;
      font-size:0.88rem;
    }

    .amount-block{
      margin-top:12px;
      max-width:260px;
    }

    .amount-row{
      display:flex;
      justify-content:space-between;
      margin-bottom:4px;
      font-size:0.9rem;
    }

    .amount-row.total{
      margin-top:4px;
      padding-top:4px;
      border-top:1px solid #ccc;
      font-weight:700;
      font-size:0.95rem;
    }

    .quote-footer{
      margin-top:20px;
      border-top:1px solid #ddd;
      padding-top:8px;
      font-size:0.75rem;
      color:#555;
      display:flex;
      flex-direction:column;
      gap:3px;
    }

    .quote-footer span{
      display:block;
    }

    @media (max-width:700px){
      .quote-header{
        flex-direction:column;
        align-items:flex-start;
      }
      .quote-meta{
        text-align:left;
      }
      .quote-wrapper{
        padding:18px 14px 14px;
      }
    }

    /* Impression : ne garder QUE le devis */
    @media print {

      @page {
        margin-top: 0;
        margin-bottom: 0;
      }

      * {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }

      body {
        margin: 0;
        padding: 0;
        background: white !important;
      }

      .page {
        max-width: none;
        padding: 0;
        margin: 0;
      }

      /* On NE veut pas voir :
         - le titre
         - le formulaire
         - les boutons
         - le logo de la page web
      */
      h1,
      .form-card,
      .btn-row,
      .site-footer-logo {
        display: none !important;
      }

      /* Le conteneur du devis prend toute la largeur */
      .layout {
        display: block;
      }

      .quote-card {
        flex: 1 1 100%;
        padding: 0;
        margin: 0;
      }

      .quote-wrapper {
        max-width: none;
        margin: 0;
        box-shadow: none;
        border: none;
        border-radius: 0;
        padding: 20mm 15mm;  /* marges A4 */
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <h1>
      Générateur de devis<br>
      <span class="h1-sub">Equinox</span>
    </h1>

    <div class="layout">
      <!-- FORMULAIRE -->
      <div class="card form-card">
        <div class="section-title">Paramètres du devis</div>
        <div class="form-grid">
          <!-- Date -->
          <div>
            <label for="dateDevis">Date du devis</label>
            <div class="inline-fields">
              <input type="date" id="dateDevis" />
              <button type="button" class="btn-secondary" id="btnToday">Aujourd'hui</button>
            </div>
          </div>

          <!-- Numéro devis -->
          <div>
            <label for="numSuffix">Numéro de devis</label>
            <div style="font-size:0.8rem;color:var(--muted);margin-bottom:4px;">
              Format : <code>DEVIS-AAAA-XXXX</code> – tu saisis uniquement les 4 derniers chiffres.
            </div>
            <div class="inline-fields">
              <input type="text" id="numSuffix" placeholder="0017" maxlength="4" />
            </div>
          </div>

          <!-- Client -->
          <div>
            <label for="clientNom">Nom du client</label>
            <input type="text" id="clientNom" placeholder="Nom du client" />
          </div>

          <div>
            <label for="clientAdresse">Adresse du client</label>
            <textarea id="clientAdresse" placeholder="Adresse complète"></textarea>
          </div>

          <!-- Description -->
          <div>
            <label for="intervention">Description de l'intervention</label>
            <textarea id="intervention" placeholder="Détaille l'intervention ici"></textarea>
          </div>

          <!-- Montant -->
          <div>
            <label for="montant">Montant (avant réduction) – en €</label>
            <input type="number" id="montant" placeholder="0.00" step="0.01" min="0" />
          </div>

          <!-- Réduction -->
          <div>
            <label>Réduction</label>
            <div class="switch-row">
              <span style="font-size:0.85rem;color:var(--muted);">Appliquer une réduction ?</span>
              <label class="switch">
                <input type="checkbox" id="hasDiscount" />
                <span class="slider"></span>
              </label>
            </div>
            <div id="discountBlock" style="margin-top:8px;display:none;">
              <label for="discountPercent">Pourcentage de réduction (%)</label>
              <input type="number" id="discountPercent" placeholder="10" step="0.1" min="0" max="100" />
            </div>
          </div>
        </div>

        <div class="btn-row">
          <button type="button" id="btnGenerate">Mettre à jour le devis</button>
          <button type="button" class="btn-secondary" id="btnPrint">Imprimer / PDF</button>
        </div>
      </div>

      <!-- APERÇU DU DEVIS -->
      <div class="quote-card">
        <div class="quote-wrapper" id="quoteArea">
          <!-- En-tête -->
          <div class="quote-header">
            <div class="company-block">
              <div class="company-name">Equinox</div>
              <div>38800 Le Pont de Claix</div>
              <div>Quentin.Culot38@gmail.com</div>
              <div>Tel : 07&#8203; 58&#8203; 66&#8203; 30&#8203; 69</div>
              <div>SIRET : 927843185&#8203;00012</div>
            </div>

            <div class="quote-meta">
              <div>
                <strong>Devis N° :</strong>
                <span id="previewDevisNum">DEVIS-2025-0001</span>
              </div>
              <div>
                <strong>Date :</strong>
                <span id="previewDate">01/01/2025</span>
              </div>
            </div>
          </div>

          <!-- Client -->
          <div class="quote-section">
            <div class="quote-section-title">Client :</div>
            <div id="previewClient">Nom du client</div>
          </div>

          <div class="quote-section">
            <div class="quote-section-title">Adresse :</div>
            <div class="quote-address" id="previewAdresse">Adresse du client</div>
          </div>

          <!-- Description -->
          <div class="quote-section" style="margin-top:10px;">
            <div class="quote-section-title">Description de l'intervention :</div>
            <div class="quote-desc" id="previewIntervention">
Intervention à décrire…
            </div>
          </div>

          <!-- Montants -->
          <div class="amount-block">
            <div class="amount-row">
              <span>Montant :</span>
              <span id="previewMontant">0,00 €</span>
            </div>
            <div class="amount-row" id="previewReductionRow" style="display:none;">
              <span>Réduction (<span id="previewReductionPercent">0</span> %) :</span>
              <span id="previewReductionAmount">-0,00 €</span>
            </div>
            <div class="amount-row total">
              <span>Total à payer :</span>
              <span id="previewTotal">0,00 €</span>
            </div>
          </div>

          <!-- Pied de page devis -->
          <div class="quote-footer">
            <span>TVA non applicable, article 293 B du CGI</span>
            <span>RIB : FR76&#8203; 1390&#8203; 6000&#8203; 3100&#8203; 2110&#8203; 5731&#8203; 914</span>
            <span>BIC : AGRI&#8203;FRPP&#8203;839</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Utilitaires date
    function formatDateFRFromISO(isoStr){
      if(!isoStr) return "";
      const [y,m,d] = isoStr.split("-");
      return d + "/" + m + "/" + y;
    }

    function todayISO(){
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,"0");
      const day = String(d.getDate()).padStart(2,"0");
      return y + "-" + m + "-" + day;
    }

    // Références DOM
    const dateInput        = document.getElementById("dateDevis");
    const btnToday         = document.getElementById("btnToday");
    const numSuffixInput   = document.getElementById("numSuffix");
    const clientInput      = document.getElementById("clientNom");
    const adresseInput     = document.getElementById("clientAdresse");
    const interInput       = document.getElementById("intervention");
    const montantInput     = document.getElementById("montant");
    const hasDiscountInput = document.getElementById("hasDiscount");
    const discountBlock    = document.getElementById("discountBlock");
    const discountInput    = document.getElementById("discountPercent");

    const previewDate          = document.getElementById("previewDate");
    const previewDevisNum      = document.getElementById("previewDevisNum");
    const previewClient        = document.getElementById("previewClient");
    const previewAdresse       = document.getElementById("previewAdresse");
    const previewIntervention  = document.getElementById("previewIntervention");
    const previewMontant       = document.getElementById("previewMontant");
    const previewReductionRow  = document.getElementById("previewReductionRow");
    const previewReductionPct  = document.getElementById("previewReductionPercent");
    const previewReductionAmt  = document.getElementById("previewReductionAmount");
    const previewTotal         = document.getElementById("previewTotal");

    const btnGenerate = document.getElementById("btnGenerate");
    const btnPrint    = document.getElementById("btnPrint");

    // Init : date du jour
    dateInput.value = todayISO();
    previewDate.textContent = formatDateFRFromISO(dateInput.value);

    // Bouton "Aujourd'hui"
    btnToday.addEventListener("click", () => {
      dateInput.value = todayISO();
      previewDate.textContent = formatDateFRFromISO(dateInput.value);
    });

    // Afficher / cacher le bloc de remise
    hasDiscountInput.addEventListener("change", () => {
      discountBlock.style.display = hasDiscountInput.checked ? "block" : "none";
    });

    // Fonction principale de mise à jour de l’aperçu
    function updatePreview(){
      const now = new Date();
      const year = now.getFullYear();

      // Date
      const dateISO = dateInput.value || todayISO();
      previewDate.textContent = formatDateFRFromISO(dateISO);

      // Numéro de devis : DEVIS-YYYY-XXXX (XXXX = 4 derniers chiffres saisis)
      let suffix = (numSuffixInput.value || "1").replace(/\D/g,"");
      suffix = suffix.slice(-4);
      suffix = suffix.padStart(4,"0");
      const fullNum = `DEVIS-${year}-${suffix}`;
      previewDevisNum.textContent = fullNum;

      // Client & adresse
      const clientNom = clientInput.value.trim() || "Nom du client";
      previewClient.textContent = clientNom;

      const adresse = adresseInput.value.trim() || "Adresse du client";
      previewAdresse.textContent = adresse;

      // Description
      const inter = interInput.value.trim() || "Intervention à décrire…";
      previewIntervention.textContent = inter;

      // Montant + réduction
      let montant = parseFloat(String(montantInput.value).replace(",","."));
      if(isNaN(montant)) montant = 0;

      let discountPercent = 0;
      let discountAmount = 0;
      let total = montant;

      if(hasDiscountInput.checked){
        discountPercent = parseFloat(String(discountInput.value).replace(",","."));
        if(isNaN(discountPercent) || discountPercent <= 0){
          discountPercent = 0;
        }
        if(discountPercent > 0){
          discountAmount = montant * (discountPercent/100);
          total = montant - discountAmount;
        }
      }

      const fmt = (v) => v.toLocaleString("fr-FR", {
        minimumFractionDigits:2,
        maximumFractionDigits:2
      }) + " €";

      previewMontant.textContent = fmt(montant);

      if(discountPercent > 0 && discountAmount > 0){
        previewReductionRow.style.display = "flex";
        previewReductionPct.textContent   = discountPercent.toLocaleString("fr-FR");
        previewReductionAmt.textContent   = "-" + fmt(discountAmount).replace(" €","") + " €";
      }else{
        previewReductionRow.style.display = "none";
      }

      previewTotal.textContent = fmt(total);
    }

    btnGenerate.addEventListener("click", updatePreview);

    dateInput.addEventListener("change", updatePreview);
    numSuffixInput.addEventListener("input", updatePreview);
    clientInput.addEventListener("input", updatePreview);
    adresseInput.addEventListener("input", updatePreview);
    interInput.addEventListener("input", updatePreview);
    montantInput.addEventListener("input", updatePreview);
    discountInput.addEventListener("input", updatePreview);
    hasDiscountInput.addEventListener("change", updatePreview);

    btnPrint.addEventListener("click", () => {
      updatePreview();
      window.print();
    });

    updatePreview();
  </script>

  <div class="site-footer-logo">
    <img src="LOGOS/logo-devis.png" class="site-logo-img" alt="Logo">
  </div>
</body>
</html>
